# ----------------------------------------------------------------------
# | Core Settings
# ----------------------------------------------------------------------

# Prevent directory browsing (hides your file list from the public)
Options All -Indexes

# Set the default character set to UTF-8
AddDefaultCharset utf-8

# ----------------------------------------------------------------------
# | Security Headers & Rules
# ----------------------------------------------------------------------

# Block access to hidden files and directories (like .git, .env, .htaccess)
<IfModule mod_rewrite.c>
RewriteCond % { SCRIPT_FILENAME } -d [OR]
RewriteCond % { SCRIPT_FILENAME } -f
RewriteRule "(^|/)\." - [F]
</IfModule>

# Force HSTS (tells browsers to ONLY use HTTPS for the next year)
<IfModule mod_headers.c>
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
# Protect against Clickjacking
Header set X-Frame-Options "SAMEORIGIN"
    
# Protect against MIME sniffing
Header set X-Content-Type-Options "nosniff"
</IfModule>

# ----------------------------------------------------------------------
# | Rewrites & URLs
# ----------------------------------------------------------------------

<IfModule mod_rewrite.c>
RewriteEngine On

# 0. DIRECTORY INDEX STRIPPER
# If the URL ends in /index or /index.html, redirect to the root /
RewriteCond % { THE_REQUEST } ^.*/index(\.html)?\s [NC]
RewriteRule ^index(\.html)?$ / [R=301, L]

# 1. Force HTTPS
RewriteCond % { HTTPS } off
RewriteRule ^(.*)$ https://% { HTTP_HOST }/$1 [R=301, L]

# 2. Force non-www
RewriteCond % { HTTP_HOST } ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301, L]

# 3. Clean URLs (Remove .html extension for everything else)
RewriteCond % { THE_REQUEST } \s/+(.+?)\.html[\s?] [NC]
RewriteRule ^ /%1 [R=301, L]

# Internally map clean URLs back to the .html file
RewriteCond % { REQUEST_FILENAME } !-d
RewriteCond % { REQUEST_FILENAME }.html -f
RewriteRule ^(.*)$ $1.html [NC, L]
</IfModule>

# ----------------------------------------------------------------------
# | Performance (Compression & Caching)
# ----------------------------------------------------------------------

# Enable Gzip compression for text files (HTML, CSS, JS)
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript
</IfModule>

# Browser Caching - Speed up the site for returning visitors
<IfModule mod_expires.c>
ExpiresActive on
ExpiresDefault "access plus 1 month"
    
# CSS and JS (1 year)
ExpiresByType text/css "access plus 1 year"
ExpiresByType application/javascript "access plus 1 year"
    
# Images (1 month)
ExpiresByType image/jpg "access plus 1 month"
ExpiresByType image/jpeg "access plus 1 month"
ExpiresByType image/png "access plus 1 month"
ExpiresByType image/gif "access plus 1 month"
ExpiresByType image/webp "access plus 1 month"
</IfModule>

# ----------------------------------------------------------------------
# | Error Handling
# ----------------------------------------------------------------------

# Custom 404 Page (Create a file named 404.html to use this!)
ErrorDocument 404 /404.html